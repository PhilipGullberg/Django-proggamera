{% extends 'profile_layout.html' %}
{% block content %}
{% load static %}
<h3 class="py-2">Översikt {{classroom}} - {{course}}</h3>
<div class="d-flex">
    <div class="topbanner ml-0 mt-2 p-3 pr-2 mb-5 w-50 rounded">
        <div class="d-flex justify-content-between ">
            <div class="d-flex flex-column  pl-4 pt-1">
                <div>
                    <h3 class="pt-0 mt-0">Senaste uppgifter</h3>
                </div>
                <div class="pr-5">
                    <table class="mb-5">
                        <tr>
                            <th>Quiz</th>
                            <th>Läst</th>
                            <th>Fyll i</th>
                        </tr>
                        <tr>
                            <td>{{classroom}} :
                                {%for course in classroom.courses.all|slice:"1" %}
                                {{course}} :
                                {%for chap in course.chapters_set.all|slice:"1"%}
                                {{chap}}
                                {%endfor%}
                            </td>
                            <td>
                                {{classroom}} :
                                {%for course in classroom.courses.all|slice:"1" %}
                                {{course}} :
                                {%for chap in course.chapters_set.all|slice:"1"%}
                                {{chap}}
                                {%endfor%}
                                {%endfor%}
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>
                                {%for course in classroom.courses.all|slice:"1:" %}
                                {{classroom}} :
                                {{course}} :

                                {%for chap in course.chapters_set.all|slice:"1:"%}
                                {{chap}}
                                {%endfor%}

                                {%endfor%}</td>
                            <td>
                                {%for course in classroom.courses.all|slice:"1:" %}
                                {{classroom}} :
                                {{course}} :

                                {%for chap in course.chapters_set.all|slice:"1:"%}
                                {{chap}}
                                {%endfor%}

                                {%endfor%}
                            </td>
                        </tr>
                        {%endfor%}
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </table>

                </div>
                <div class="mb-2 align-item-end">
                    <div class="stnd-btn w-50"><a style="text-decoration: none; color:white;"
                            href="{% url 't_classroom' %}">Lägg till ny uppgift</a> </div>
                </div>
            </div>

        </div>
    </div>
    <div class="mt-0 ms-5 w-50 text-center">
        <h3 class="pt-0 mt-0">Totala resultat</h3>
        <canvas style="z-index: 9999" class="pl-5 pr-5 " id="myChart"></canvas>
    </div>
</div>
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#allt" type="button"
            role="tab" aria-controls="home" aria-selected="true">Allt</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#quiz" type="button" role="tab"
            aria-controls="profile" aria-selected="false">Quizresultat</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#inlämning" type="button"
            role="tab" aria-controls="contact" aria-selected="false">Inlämningsuppgifter</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#kapitel" type="button"
            role="tab" aria-controls="contact" aria-selected="false">Kapitel och videos</button>
    </li>
</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="allt" role="tabpanel" aria-labelledby="home-tab">
        <div class="resultpage py-3">
            <h4 class="pb-3">Här kan du se all data på dina elevers framsteg.</h4>
            <a class="btn bg-light mb-2" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                Klicka här för mer info om vad tabellen visar
              </a>
              <div class="collapse " id="collapseExample">
                <div class="card-body mb-3 bg-light text-dark">
                    <h3 class="mb-3">Vad betyder ikonerna?</h3>
                    <div class="d-flex justify-content-between">
                        <div class="pe-4 ps-3 ">
                            <h5>Quiz</h5>
                            
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon me-2 bg-dark" src="{%static 'profilepage/icquiznullwhite.png' %}"></img><p class="m-0">Innebär att kapitlet har ett quiz och eleven inte gjort det</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquiz.png' %}"></img><p class="m-0">Innebär att eleven har klarat quizet</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquizwrong.png' %}"></img><p class="m-0">Innebär att eleven gjort quizet men inte haft rätt</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquiznullwhite.png' %}"></img><p class="m-0">Innebär att kapitlet har ett quiz</p>
                            </div>
                        </div>
                        <div class="me-5 pe-5">
                            <h5 >Fill in the blanks</h5>
                            
                            <div class="d-flex align-items-center">
                                <i  class="fill fa-brands fa-wpforms pe-2"></i>Innebär att kapitlet har en fill in the blanks och eleven inte gjort det</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <i id="right" class="fill fa-brands fa-wpforms pe-2"></i>Innebär att eleven har klarat fill in the blanks</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <i id="wrong" class="fill fa-brands fa-wpforms pe-2"></i>Innebär att eleven ej har klarat fill in the blanks</p>
                            </div>   
                        </div>
                       
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <div class="pe-4 ps-3 ">
                            <h5>Kollat video</h5>
                            
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon me-2 bg-dark" src="{%static 'profilepage/icquiznullwhite.png' %}"></img><p class="m-0">Innebär att kapitlet har ett quiz och eleven inte gjort det</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquiz.png' %}"></img><p class="m-0">Innebär att eleven har klarat quizet</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquizwrong.png' %}"></img><p class="m-0">Innebär att eleven gjort quizet men inte haft rätt</p>
                            </div>
                            <div class="d-flex align-items-center">
                                <img class="quiz-icon pe-2" src="{%static 'profilepage/icquiznullwhite.png' %}"></img><p class="m-0">Innebär att kapitlet har ett quiz</p>
                            </div>
                        </div>
                        <div class="me-5 pe-5">
                            <h5 >Läst kapitel</h5>
                            
                            <div class="d-flex align-items-center">
                                <i  class="fill fa-brands fa-wpforms pe-2"></i>Innebär att kapitlet har en fill in the blanks och eleven inte gjort det</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <i id="right" class="fill fa-brands fa-wpforms pe-2"></i>Innebär att eleven har klarat fill in the blanks</p>
                            </div>   
                            <div class="d-flex align-items-center">
                                <i id="wrong" class="fill fa-brands fa-wpforms pe-2"></i>Innebär att eleven ej har klarat fill in the blanks</p>
                            </div>   
                        </div>
                    </div>
                  
                </div>
              </div>
            
            <div class="table-responsive">
                <table class="table">
                    <tr >
                        <th cope="col">Elev/Kapitel</th>
                        {%for chapter in chapters %}
                        {% for subchapter in chapter.sub.all%}
                        <th cope="col">{{chapter.chapter_number}}.{{subchapter.subchapter_number}} {{subchapter}}</th>
                        {%endfor%}
                        {%endfor%}
                    </tr>

                    {% for student in students %}
                    <tr>
                        <th scope="row">{{student}}</th>

                        {%for chapter in chapters %}
                            {% for subchapter in chapter.sub.all%}
                            <td >
                            <div class="d-flex align-items-center ">
                                <!-- Code to show results of quizes-->
                                <div class="quiz-data me-2">
                                    {% if subchapter.quiz_set.all %}
                                        {% for quizresult in subchapter.quiz_set.all.first.quizresult_set.all%}
                                            {% if student == quizresult.students%}
                                                {% if quizresult.result == 1 %}
                                                    <img class="quiz-icon" src="{%static 'profilepage/icquiz.png' %}"></img>   
                                                {%else%}
                                                    <img class="quiz-icon" src="{%static 'profilepage/icquizwrong.png' %}"></img>
                                                {%endif%}
                                            {%endif%}
                            
                                        {%endfor%}
                                        <img id="iconnull" src="{%static 'profilepage/icquiznullwhite.png' %}"></img>
                                   
                                    {%endif%}
                                </div>
                                <div class="fill-data me-2">
                                    <!--Code to show results for fillinblanks-->
                                    {% if subchapter.fillinblanks_set.all %}
                                        {% for fillresult in subchapter.fillinblanks_set.all.first.fillinblanksresults_set.all %}
                                            {% if student == fillresult.student %}
                                                {% if fillresult.result == 1 %}
                                                    <i id="right" class="fill fa-brands fa-wpforms"></i>
                                                {%else%}
                                                    <i id="wrong" class="fill fa-brands fa-wpforms"></i>
                                                {%endif%}
                                            {%endif%}
                                        {%endfor%}
                                        <i class="fa-brands fa-wpforms"></i>

                                    
                                    {%endif%}
                                </div>
                                <div class="read-data me-2">
                                    {% for page in visited %}
                                        {% if student == page.student %}
                                            {% if page.subchapter == subchapter %}
                                                <i id="right" class="fa-solid fa-book"></i>
                                            {%endif%}
                                        {%endif%}
                                    {%endfor%}
                                    <i style="color:white" class="fa-solid fa-book"></i>
                                </div>
                            </div>
                            {%endfor%}
                            </td>
                        {%endfor%}
                    </tr>
                    {%endfor%}
                </table>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="quiz" role="tabpanel" aria-labelledby="profile-tab">
        <div class="resultpage py-3">
            <div class="classroom p-4 mb-3 mr-5 rounded">
                
                <h5 class="pb-1">{{course}}</h5>
                <table class="sortable result_table">
                    <tr>
                        <th>Elev</th>
                        <th>Delkapitel</th>
                        <th>Quiz</th>
                        <th>Svarat</th>
                        <th>Rätt svar</th>
                        <th>Resultat</th>
                    </tr>
                    {% for student in students%}
                        {% for result in student.quizresult_set.all %}
            
                            {% if result.quiz.parent.parent_chapter.course == course%}
                            <tr>
                                <td>{{student}}</td>
                                <td>{{result.quiz.parent}}</td>
                                <td>{{result.quiz}}</td>
                                <td>{{result.answers}}</td>
                                <td>{{result.quiz.ans}}</td>
                                <td>{{result.result}}</td>
                            </tr>
                            {%endif%}
                        {%endfor%}
                    {%endfor%}
        
        
        
        
                </table>

              
            </div>
        
        </div>
    </div>
    <div class="tab-pane fade" id="inlämning" role="tabpanel" aria-labelledby="contact-tab">
        <p>Här kan du se alla dina elevers inlämningsuppgifter.</p>
    </div>
    <div class="tab-pane fade" id="kapitel" role="tabpanel" aria-labelledby="contact-tab">
        <p>Här kan du följa vilka kapitel och videos som dina elever har sett</p>
    </div>
</div>






<script>
    window.addEventListener('DOMContentLoaded',function(){
        var quizdata= document.querySelectorAll(".quiz-data");
        for(let i=0; i<quizdata.length;i++){
            for(let j=0; j<quizdata[i].children.length;j++){
                if(quizdata[i].children[j].className=="quiz-icon"){
                    quizdata[i].children[j+1].remove();
                    
                }
            }
        }
        var filldata= document.querySelectorAll(".fill-data");
        for(let i=0; i<filldata.length;i++){
            for(let j=0; j<filldata[i].children.length;j++){
                console.log(filldata[i].children[j]);
                if(filldata[i].children[j].id=="right" || filldata[i].children[j].id=="wrong" ){
                    filldata[i].children[j+1].remove();
                    
                }
            }
        }
        var bookdata= document.querySelectorAll(".read-data");
        for(let i=0; i<bookdata.length;i++){
            for(let j=0; j<bookdata[i].children.length;j++){
                console.log(bookdata[i].children[j]);
                if(bookdata[i].children[j].id=="right"){
                    bookdata[i].children[j+1].remove();
                    
                }
            }
        }
    });

    const data = {
        labels: [
            'Red',
            'Green',
            'Yellow'
        ],
        datasets: [{
            label: 'My First Dataset',
            data: [20, 150, 100],
            backgroundColor: [
                'rgb(255, 99, 132)',
                'green',
                'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
        }]
    };

    const config = {
        type: 'doughnut',
        data: data,
        options: {}
    };
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );
</script>
{%endblock%}